<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="noindex,nofollow">
<title>Streaming Player</title>
<link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css"/>
<style>
body, html {
  margin: 0; padding: 0; width: 100%; height: 100%; background: #000; font-family: Arial, sans-serif; overflow: hidden;
}
.container-wrapper { width: 100%; height: 100%; display: flex; flex-direction: column; }
.player-container { position: relative; width: 100%; flex-grow: 1; background: #000; }
#video-player, .plyr { width: 100% !important; height: 100% !important; }
.banner-ad-container { position: absolute; bottom: 60px; left: 10px; width: 300px; height: 250px; z-index: 5; }
.plyr--fullscreen-active .banner-ad-container { display: none; }
</style>
</head>
<body>
<script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>

<div class="container-wrapper">
  <div class="player-container">
    <video id="video-player" playsinline muted></video>
    <div class="banner-ad-container">
      <script type="text/javascript">
        atOptions = { 'key' : 'fd71a2f8353ddd1d4906b0e7d7187be2', 'format' : 'iframe', 'height' : 250, 'width' : 300, 'params' : {} };
      </script>
      <script type="text/javascript" src="//www.highperformanceformat.com/fd71a2f8353ddd1d4906b0e7d7187be2/invoke.js"></script>
    </div>
  </div>
  <a href="#" id="download-button" class="tombol-download" target="_blank" rel="noopener noreferrer">DOWNLOAD VIDEO</a>
</div>

<script>
const urlParams = new URLSearchParams(window.location.search);
const videoSource = urlParams.get('s');
const downloadLink = urlParams.get('d');
const subSource = urlParams.get('sub');
const SMARTLINK_URL = urlParams.get('smart') || 'https://example.com/smartlink'; // ganti dengan link smartlink
const downloadButton = document.getElementById('download-button');

if(downloadLink){
  downloadButton.href = downloadLink;
} else {
  downloadButton.style.display = 'none';
}

let lastClickTime = 0; // untuk interval smartlink ≥4 detik

document.addEventListener('DOMContentLoaded', () => {
  const video = document.getElementById('video-player');

  if(videoSource){
    const sourceElem = document.createElement('source');
    sourceElem.src = videoSource;
    sourceElem.type = 'video/mp4';
    video.appendChild(sourceElem);
  } else {
    alert('Error: Video tidak ditemukan!');
    return;
  }

  if(subSource){
    const track = document.createElement('track');
    track.kind = 'subtitles';
    track.src = subSource;
    track.srclang = 'id';
    track.label = 'Bahasa Indonesia';
    track.default = true;
    video.appendChild(track);
  }

  const player = new Plyr('#video-player', {
    muted: true,
    autoplay: false,
    settings: ['speed','captions'],
    speed: { selected: 1, options: [0.5,1,2,3] },
    controls: ['play','rewind','mute','volume','progress','current-time','duration','captions','settings','fast-forward','fullscreen']
  });

  // Fungsi buka smartlink jika interval ≥4 detik
  function tryOpenSmartlink() {
    const now = Date.now();
    if(now - lastClickTime >= 4000){ // ≥4 detik
      window.open(SMARTLINK_URL,'_blank');
      lastClickTime = now;
    }
  }

  // Semua interaksi utama memicu smartlink
  const interactiveEvents = ['play','pause','enterfullscreen','exitfullscreen','ratechange'];
  interactiveEvents.forEach(evt => {
    player.on(evt, () => tryOpenSmartlink());
  });

  // Klik langsung di video juga dihitung
  video.addEventListener('click', tryOpenSmartlink);
});
</script>
</body>
</html>
